# pq1-05: Minimal zkVM for Lean Ethereum

## Categories
- leanVM
- formal verification

## Related Talks
- [leanVM-01](leanVM-01.md): leanVM Crash Course & Sumcheck Optimization
- [leanVM-02](leanVM-02.md): Memory Models & Lookup Arguments
- [leanVM-03](leanVM-03.md): Compiler (workshop)
- [pq1-06](pq1-06.md): XMSS Signature Aggregation
- [pq2-04](pq2-04.md): Minimal zkVM
- [pq3-03](pq3-03.md): Minimal zkVM - Cairo M Design

## Summary
Emile, an Ethereum Foundation grantee, presented a minimal zero-knowledge virtual machine (zkVM), dubbed leanVM or LeanISA, designed for efficient post-quantum XMSS signature aggregation and recursive merging in Ethereum's lean consensus layer. Inspired by Cairo but simplified (e.g., no allocation pointer), it uses the KoalaBear field (p = 2^31 - 2^24 + 1) for efficient Poseidon2 hashing and a degree-5/6 extension for ~128-bit security under WHIR's conjectures. The VM features read-only memory, registers (pc, fp), and a basic ISA with ADD/MUL (frame-relative), DEREF (for dereferencing and range checks in 3 cycles), conditional JUMP (with fp updates for calls/returns), and precompiles (Poseidon 16/24, dot product, multilinear eval). Proofs leverage multilinear polynomials, WHIR PCS, and LogUp* for indexed lookups, committing only essential columns (e.g., 5 base-field elements per cycle in execution table) to minimize costs. The unified AggregateMerge program handles both aggregation and recursion, with hints enabling deterministic memory allocation. Current status: Aggregation implemented, recursion pending; targets 5x speedup via optimizations; CPU-based, multi-threaded.

## Key Takeaways
- **Post-Quantum Aggregation**: Enables XMSS verification and recursive SNARK merging, replacing BLS with hash-based schemes for quantum resistance.
- **Simplified ISA**: 4 core opcodes + precompiles suffice for Turing completeness; DEREF/JUMP enable functions/loops without allocation pointer, using prover hints for memory.
- **Efficient Proof System**: Multilinear setup with WHIR PCS and LogUp* reduces commitments (e.g., virtual columns for bytecode/flags, saving on 15-20 flags per instruction).
- **Field Choice**: KoalaBear optimizes Poseidon2 (x^3 S-box); extension assumes WHIR conjecture for security, avoiding random oracles.
- **Implementation Progress**: Aggregation complete; needs recursion, XMSS with new encodings; performance gains from unrolling loops, SIMD, and sumcheck optimizations.
- **Formal Verification**: Planned for ISA, AggregateMerge, and XMSS programs to ensure soundness.
- **Q&A Insights**: LogUp* chosen for simplicity despite slight inefficiency vs. LogUp for memory; alternatives like ProtoStar or tree-structured memory discussed for potential gains.

## Speakers
- Emile (EF grantee)

## Resources
- [Slides](https://drive.google.com/file/d/1gg4XxLYY_PAcqZWKPopjK8m85-gLBH--/view?usp=drive_link)
- ePrint Papers on LeanSig/XMSS: [2025/055: Hash-Based Multi-Signatures for Post-Quantum Ethereum](https://eprint.iacr.org/2025/055), [2025/889: At the Top of the Hypercube -- Better Size-Time Tradeoffs for Hash-Based Signatures](https://eprint.iacr.org/2025/889), [2025/1332: Technical Note: LeanSig for Post-Quantum Ethereum](https://eprint.iacr.org/2025/1332)
- WHIR PCS: [2024/1586: WHIR: Reedâ€“Solomon Proximity Testing with Super-Fast Verification](https://eprint.iacr.org/2024/1586)
- [Video](https://youtu.be/DBjiIAj78UA)

> back to: [Index Page](index.md)

*Note: Summaries were generated in part with the help of AI, so names and terms may not be 100% accurate.*